<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="emptype.css">
	<script>
		function debounce(func, wait, immediate) {
			var timeout;
  		return function executedFunction() {
	    var context = this;
	    var args = arguments;
    	var later = function() {
      	timeout = null;
      	if (!immediate) func.apply(context, args);
    	};
    	var callNow = immediate && !timeout;
    	clearTimeout(timeout);
    	timeout = setTimeout(later, wait);
    	if (callNow) func.apply(context, args);
  		};
		};
		function addColor() {
			var area = document.querySelector('#area');
			var color = document.querySelector('#picker').value;

			var startPos = area.selectionStart;
        var endPos = area.selectionEnd;
        area.value = area.value.substring(0, startPos)
            + color
            + area.value.substring(endPos, area.value.length);
			updateDiv();
			area.focus();
		}
		function updateDiv() {
			var areatxt = document.querySelector('#area').value;
			while (areatxt.indexOf('[') >= 0) {
				var start = areatxt.indexOf('[');
				var end = areatxt.indexOf(']');
				var colorHex = areatxt.substring(start + 1, end);
				areatxt = areatxt.replace(/\[.*?\]/, `</span><span style="color:${colorHex}">`)
			}
			document.querySelector('#divtext').innerHTML = `<span>${areatxt}</span>`;
		}
		function copyText() {
			var area = document.querySelector('#area');
			area.select();
			document.execCommand('copy');
		}
	</script>
</head>
<body>
	<div class='text'>
		<textarea id='area' name='area' cols='2' rows='4''></textarea>
	</div>
	<div class='controls'>
		<span>
			<button onClick='addColor("blue")'>Add Color</button>
		</span>
		<span>
			<select class='picker' id='picker' name='picker'>
				<option value='[#FFFFFF]'>White</option>
				<option value='[#00BFFF]'>DeepSkyBlue</option>
				<option value='[#2E8B57]'>SeaGreen</option>
				<option value='[#B22222]'>FireBrick</option>
			</select>
		</span>
	</div>
	<div class='divtext' id='divtext' name='divtext' onClick='copyText()'>
	</div>
	<script>
		var updateDivDebounced = debounce(function() {
			updateDiv();
		}, 750);
		window.addEventListener('keyup', updateDivDebounced);
	</script>
</body>
</html>